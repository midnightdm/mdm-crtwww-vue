(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-51ff8c02"],{"02f0":function(e,t,i){"use strict";i("4362a")},"4362a":function(e,t,i){},"60a5":function(e,t,i){"use strict";i.r(t);i("a4d3"),i("e01a");var s=i("7a23"),n={id:"Manage",class:"text-center"},o=Object(s["i"])("h1",null,"MANAGE NOTIFICATIONS",-1),c=Object(s["l"])("On this browser push notifications are "),r={class:"btnWrapper"},l=["disabled"],a=["disabled"],u=Object(s["l"])("  "),b={class:"boxa"},d=Object(s["i"])("h3",null,"Subscribed Events",-1),h={id:"actualOL"},m={class:"listItem"},f={class:"listBtns"},v=["onClick"],g=Object(s["l"])("  "),O=["onClick"],p=Object(s["i"])("br",null,null,-1),j=Object(s["l"])("None"),y={class:"boxb"},w=Object(s["i"])("h3",null,"Available Events",-1),S=["value"],k=Object(s["l"])(),A=Object(s["i"])("br",null,null,-1),L=Object(s["i"])("br",null,null,-1),T=Object(s["l"])("Remove Event"),C=Object(s["l"])("Subscribe to Event"),E=Object(s["l"])("  "),D=Object(s["l"])(" View Details "),R=Object(s["l"])("   "),M=Object(s["l"])("Add Default Waypoints"),V=Object(s["i"])("br",null,null,-1),I={key:2,style:{color:"red"}},P=Object(s["l"])("Notification Test"),U={key:3},z=Object(s["i"])("div",{class:"boxb boxc"},'Consider where along the river you like to watch riverboats. Choose one marker a few miles above your spot for downriver notices. Pick another below your spot for upriver notices. "Passenger" events will trigger less often than the "Any" vessel events which occur many times daily. ',-1),_=Object(s["i"])("div",{class:"boxb boxc"},'Please note that "Any" means any vessel OTHER than passenger and does not include passenger vessels also. You will get passenger vessel notices only when subscribed to passenger events. ',-1),N={class:"modal-body"},B=["src"],x=Object(s["i"])("br",null,null,-1),q={class:"description",id:"vm-description"},F=Object(s["i"])("div",{class:"spacer"},null,-1),W=Object(s["l"])("Close "),$=Object(s["l"])("  "),K=Object(s["l"])("Remove This Event"),Y=Object(s["l"])("Subscribe to This Event"),G={class:"modal-body"},H=["src"],Q=Object(s["i"])("br",null,null,-1),J={class:"description",id:"vm-description"},Z=Object(s["i"])("div",{class:"spacer"},null,-1),X=Object(s["l"])("Close "),ee=Object(s["l"])("  "),te=Object(s["l"])("Remove This Event"),ie=Object(s["l"])("Subscribe to This Event");function se(e,t,i,se,ne,oe){var ce=Object(s["H"])("w-tag"),re=Object(s["H"])("w-button"),le=Object(s["H"])("w-dialog");return Object(s["z"])(),Object(s["h"])(s["a"],null,[Object(s["i"])("main",n,[Object(s["i"])("section",null,[o,Object(s["i"])("p",null,[c,Object(s["m"])(ce,{class:"mr4","bg-color":"yellow",color:"primary",round:""},{default:Object(s["V"])((function(){return[Object(s["l"])(Object(s["L"])(e.statusTxt),1)]})),_:1})]),Object(s["i"])("p",r,[e.isSubscribed?(Object(s["z"])(),Object(s["h"])("button",{key:0,onClick:t[0]||(t[0]=function(e){return oe.unsubscribeUser()}),class:"pushtoglbtn",disabled:e.pbIsDisabled},Object(s["L"])(e.pbLabel),9,l)):(Object(s["z"])(),Object(s["h"])("button",{key:1,onClick:t[1]||(t[1]=function(e){return oe.subscribeUser()}),class:"pushtoglbtn",disabled:e.pbIsDisabled},Object(s["L"])(e.pbLabel),9,a)),u]),Object(s["i"])("div",b,[d,Object(s["i"])("ol",h,[(Object(s["z"])(!0),Object(s["h"])(s["a"],null,Object(s["F"])(e.mm.subListActual,(function(e){return Object(s["z"])(),Object(s["h"])("li",{key:e.key},[Object(s["i"])("span",m,Object(s["L"])(e.title),1),Object(s["i"])("span",f,[Object(s["i"])("button",Object(s["r"])({id:"remBtn"+e.key},{onClick:function(t){return oe.removeActualEvent(e.key)}}),"Delete",16,v),g,Object(s["i"])("button",Object(s["r"])({id:"revBtn"+e.key},{onClick:function(t){return oe.reviewActualEvent(e.key)}}),"Review",16,O)])])})),128))]),p,e.mm.subListActual.length?Object(s["g"])("",!0):(Object(s["z"])(),Object(s["f"])(ce,{key:0,id:"actualNone",class:"mr4","bg-color":"primary",color:"yellow",round:""},{default:Object(s["V"])((function(){return[j]})),_:1}))]),Object(s["i"])("div",y,[w,Object(s["i"])("select",{name:"sub-list-avail",onChange:t[2]||(t[2]=function(){return oe.getSelection&&oe.getSelection.apply(oe,arguments)}),id:"sub-list-avail",class:"form-select",size:"5"},[(Object(s["z"])(!0),Object(s["h"])(s["a"],null,Object(s["F"])(e.mm.subListAvail,(function(e){return Object(s["z"])(),Object(s["h"])("option",{key:e.key,value:e.key},Object(s["L"])(e.title),9,S)})),128))],32),k,A,L,e.selectionFound?(Object(s["z"])(),Object(s["f"])(re,{key:0,class:"btnGrpA",onClick:t[3]||(t[3]=function(t){return oe.removeActualEvent(e.mm.subListSelection.key)})},{default:Object(s["V"])((function(){return[T]})),_:1})):(Object(s["z"])(),Object(s["f"])(re,{key:1,onClick:t[4]||(t[4]=function(e){return oe.subscribeToEvent()})},{default:Object(s["V"])((function(){return[C]})),_:1})),E,Object(s["m"])(re,{class:"px4 btnGrpA",onClick:t[5]||(t[5]=function(t){oe.getSelection,e.dialog1.show=!0}),"bg-color":"primary",dark:""},{default:Object(s["V"])((function(){return[D]})),_:1}),R,Object(s["m"])(re,{class:"btnGrpA",onClick:oe.subscribeToDefaultWaypoints},{default:Object(s["V"])((function(){return[M]})),_:1},8,["onClick"]),V,e.user&&e.user.alertTestRequest?(Object(s["z"])(),Object(s["h"])("div",I,"Test Pending")):Object(s["g"])("",!0),Object(s["m"])(re,{class:"ma1","bg-color":"info",onClick:oe.requestNotificationTest},{default:Object(s["V"])((function(){return[P]})),_:1},8,["onClick"]),e.user&&null!=e.user.alertTestedTS?(Object(s["z"])(),Object(s["h"])("div",U,"Last Test Notification Sent "+Object(s["L"])(e.user.alertTestedTS),1)):Object(s["g"])("",!0)]),z,_])]),Object(s["m"])(le,{id:"availModal",modelValue:e.dialog1.show,"onUpdate:modelValue":t[9]||(t[9]=function(t){return e.dialog1.show=t}),width:1e3,persistent:e.dialog1.persistent,"persistent-no-animation":e.dialog1.persistentNoAnimation,"title-class":"primary-light1--bg white"},{title:Object(s["V"])((function(){return[Object(s["l"])(Object(s["L"])(e.mm.subListSelection.title),1)]})),actions:Object(s["V"])((function(){return[F,Object(s["m"])(re,{onClick:t[6]||(t[6]=function(t){return e.dialog1.show=!1})},{default:Object(s["V"])((function(){return[W]})),_:1}),$,e.dialog1.remove?(Object(s["z"])(),Object(s["f"])(re,{key:0,onClick:t[7]||(t[7]=function(t){oe.removeActualEvent(e.mm.subListSelection.key),e.dialog1.show=!1})},{default:Object(s["V"])((function(){return[K]})),_:1})):(Object(s["z"])(),Object(s["f"])(re,{key:1,onClick:t[8]||(t[8]=function(t){oe.subscribeToEvent(),e.dialog1.show=!1})},{default:Object(s["V"])((function(){return[Y]})),_:1}))]})),default:Object(s["V"])((function(){return[Object(s["i"])("div",N,[Object(s["i"])("img",{id:"vm-image",class:"river-map",src:e.imagePath+"/"+e.mm.subListSelection.image,height:"600",alt:"Map image of river showing boat icon at edge of target area"},null,8,B),x,Object(s["i"])("div",q,Object(s["L"])(e.mm.subListSelection.description),1)])]})),_:1},8,["modelValue","persistent","persistent-no-animation"]),Object(s["m"])(le,{id:"actualModal",modelValue:e.dialog2.show,"onUpdate:modelValue":t[13]||(t[13]=function(t){return e.dialog2.show=t}),width:1e3,persistent:e.dialog2.persistent,"persistent-no-animation":e.dialog2.persistentNoAnimation,"title-class":"primary-light1--bg white"},{title:Object(s["V"])((function(){return[Object(s["l"])(Object(s["L"])(e.mm.actListSelection.title),1)]})),actions:Object(s["V"])((function(){return[Z,Object(s["m"])(re,{onClick:t[10]||(t[10]=function(t){return e.dialog2.show=!1})},{default:Object(s["V"])((function(){return[X]})),_:1}),ee,e.dialog1.remove?(Object(s["z"])(),Object(s["f"])(re,{key:0,onClick:t[11]||(t[11]=function(t){oe.removeActualEvent(),e.dialog2.show=!1})},{default:Object(s["V"])((function(){return[te]})),_:1})):(Object(s["z"])(),Object(s["f"])(re,{key:1,onClick:t[12]||(t[12]=function(t){oe.subscribeToEvent(),e.dialog2.show=!1})},{default:Object(s["V"])((function(){return[ie]})),_:1}))]})),default:Object(s["V"])((function(){return[Object(s["i"])("div",G,[Object(s["i"])("img",{id:"vm-image",class:"river-map",src:e.imagePath+"/"+e.mm.actListSelection.image,height:"600",alt:"Map image of river showing boat icon at edge of target area"},null,8,H),Q,Object(s["i"])("div",J,Object(s["L"])(e.mm.actListSelection.description),1)])]})),_:1},8,["modelValue","persistent","persistent-no-animation"])],64)}i("38cf"),i("ac1f"),i("5319"),i("d3b7"),i("5cc6"),i("9a8c"),i("a975"),i("735e"),i("c1ac"),i("d139"),i("3a7b"),i("d5d6"),i("82f8"),i("e91f"),i("60bd"),i("5f96"),i("3280"),i("3fcc"),i("ca91"),i("25a1"),i("cd26"),i("3c5d"),i("2954"),i("649e"),i("219c"),i("170b"),i("b39a"),i("72f7"),i("159b"),i("7db0");var ne=i("0830"),oe=i("acba"),ce=i("c62b"),re=i("e71f"),le=i("ea7b"),ae={beforeMount:function(){var e=this;this.$store.state.c.loggeduserCredentials&&!this.$store.state.c.loggeduserCredentials.isAnonymous&&this.$store.dispatch("logOut"),"serviceWorker"in navigator&&"PushManager"in window?(console.log("Service Worker and Push is supported"),navigator.serviceWorker.register("../mysw.js").then((function(t){console.log("Service Worker is registered",t),e.swRegistration=t,console.log("swRegistration value: ",e.swRegistration),e.initialiseUI()})).catch((function(e){console.error("Service Worker Error",e)}))):(console.warn("Push messaging is not supported"),this.pbLabel="Push Not Supported")},mounted:function(){this.$store.commit("setSlate","ALERTS"),this.$store.commit("setAlertsLinkActive",!0),this.$store.commit("setPageSelected","Manage")},unmounted:function(){this.$store.commit("setAlertsLinkActive",!1),this.$store.commit("setPageSelected",null),this.$store.dispatch("logOut")},data:function(){return{applicationServerPublicKey:"BECLGbHqB7pAnlQUkULcmKSzIb-Zo3DM4pYBQMvpQbsCqAkTy9vq15z1KeZhggQspwMvd2oWaFf0Vb8DqQkTidY",publicPath:"/",imagePath:"https://storage.googleapis.com/www.clintonrivertraffic.com",swRegistration:"",db:ce["a"],mm:this.initializeMM(),fsAuth:Object(le["c"])(),isSubscribed:!1,authEnc:null,user:null,pbIsDisabled:!1,pbLabel:"Enable Push",statusTxt:"Disabled",deviceRef:"",dialog1:{show:!1,fullscreen:!1,persistent:!1,persistentNoAnimation:!1,width:300,remove:!1},dialog2:{show:!1,fullscreen:!1,persistent:!1,persistentNoAnimation:!1,width:300},selectionFound:!1}},methods:{initializeMM:function(){return new ne["a"]},showAlert:function(e){alert(e)},updateBtn:function(){if("denied"===Notification.permission)return this.pbLabel="Push Messaging Blocked",this.pbIsDisabled=!0,void(this.statusTxt="Blocked");this.isSubscribed?(this.pbLabel="Disable Push",this.statusTxt="Enabled",this.pbIsDisabled=!1):(this.pbLabel="Enable Push",this.pbIsDisabled=!1,this.statusTxt="Disabled")},urlB64ToUint8Array:function(e){for(var t="=".repeat((4-e.length%4)%4),i=(e+t).replace(/\-/g,"+").replace(/_/g,"/"),s=window.atob(i),n=new Uint8Array(s.length),o=0;o<s.length;++o)n[o]=s.charCodeAt(o);return n},subscribeUser:function(){var e=this,t=this.urlB64ToUint8Array(this.applicationServerPublicKey);this.swRegistration.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:t}).then((function(t){console.log("User is subscribed."),e.isSubscribed=!0,e.updateBtn();var i=btoa(String.fromCharCode.apply(null,new Uint8Array(t.getKey("auth")))),s=btoa(String.fromCharCode.apply(null,new Uint8Array(t.getKey("p256dh"))));e.user={alertDest:"",alertMethod:"notification",alertNote:"v0 subscribeUser()",alertTestRequest:!1,alertTestedTS:null,userCreatedTS:Math.round(Date.now()/1e3),events:[],subscription:{auth:i,endpoint:t.endpoint,is_enabled:e.isSubscribed,p256dh:s}},Object(re["l"])(e.deviceRef,e.user,{merge:!0})})).catch((function(t){console.log("Failed to subscribe the user: ",t),e.updateBtn()}))},initialiseUI:function(){var e=this;this.swRegistration.pushManager.getSubscription().then((function(t){e.isSubscribed=!(null===t),e.isSubscribed?(console.log("User IS subscribed."),e.getSubList()):console.log("User is NOT subscribed."),e.updateBtn()}))},unsubscribeUser:function(){var e=this;this.swRegistration.pushManager.getSubscription().then((function(e){if(e)return e.unsubscribe()})).catch((function(e){console.log("Error unsubscribing",e)})).then((function(){Object(re["l"])(e.deviceRef,{subscription:{is_enabled:!1}},{merge:!0}),console.log("User is unsubscribed."),e.isSubscribed=!1,e.mm.subListActual=[],e.updateBtn()}))},getSubList:function(){var e=this;navigator.serviceWorker.ready.then((function(e){return e.pushManager.getSubscription()})).then((function(t){t?Object(le["f"])(e.fsAuth).catch((function(e){var t=e.code;e.message;"auth/operation-not-allowed"===t?alert("You must enable Anonymous auth in the Firebase Console."):console.error(e)})).then((function(i){var s=t.endpoint.substr(-20,20);e.mm.userID=s,null==e.mm.userID?alert("Error generating a UUID.  Try again later."):console.log("this.mm.userID=",e.mm.userID),e.deviceRef=Object(re["d"])(e.db,"user_devices",e.mm.userID),Object(re["i"])(e.deviceRef,(function(i){if(e.user=i.data(),console.log("doc.data()",e.user),e.mm.subListActual=[],void 0!==e.user)Array.isArray(e.user.events)&&e.user.events.length&&e.user.events.forEach(e.loadSubListActual);else{var s={alertDest:"",alertMethod:"notification",alertNote:"v2 onSnapshot()",alertTestRequest:!1,alertTestedTS:null,userID:e.mm.userID,userCreatedTS:Math.round(Date.now()/1e3),events:[],subscription:{auth:"",endpoint:t.endpoint,is_enabled:!1,p256dh:""}};Object(re["l"])(e.deviceRef,s)}}),(function(){var i={alertDest:"",alertMethod:"notification",alertNote:"v2 onSnapshot()",alertTestRequest:!1,alertTestedTS:null,userID:e.mm.userID,userCreatedTS:Math.round(Date.now()/1e3),events:[],subscription:{auth:"",endpoint:t.endpoint,is_enabled:!1,p256dh:""}};Object(re["l"])(e.deviceRef,i)}))})):alert("Please enable push notifications")}))},loadSubListActual:function(e,t,i){var s=this.mm.subListAvail.find((function(t){return t.key===e}));this.mm.subListActual.push(s)},reviewActualEvent:function(e){var t=this.mm.subListAvail.find((function(t){return t.key===e}));t["isSubscribed"]=!0,this.mm.actListSelection=t,console.log("actSel description: ",this.mm.actListSelection.description),this.dialog2.show=!0,this.dialog1.remove=!0},removeActualEvent:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";""==e&&(e=this.mm.actListSelection.key),console.log("removeActualEvent() subListSelection.key =",this.mm.actListSelection.key),console.log("removeActualEvent("+e+")"),Object(re["m"])(this.deviceRef,{events:Object(re["a"])(e)}).then(console.log("removeActualEvent("+e+")")),this.selectionFound=!1,this.dialog1.remove=!1},subscribeToEvent:function(){void 0!==this.user?(console.log("subListSelection =",this.mm.subListSelection.key),this.user.events.push(this.mm.subListSelection.key),Object(re["l"])(this.deviceRef,{events:this.user.events},{merge:!0}),console.log("subscribeToEvent()"),this.getSelection()):alert("You must enable (or re-enable) Push service before you can add events.")},requestNotificationTest:function(){console.log("requestNotificationTest()"),Object(re["l"])(this.deviceRef,{alertTestRequest:!0},{merge:!0}),alert("Please allow up to 3 minutes for test message to be sent to you.")},subscribeToDefaultWaypoints:function(){null!==this.user?(this.user.events.push("alphadp","deltaup"),Object(re["l"])(this.deviceRef,{events:this.user.events},{merge:!0})):alert("You must enable Push service before you can add events.")},getSelection:function(){var e=this;this.mm.getSelection().then((function(){var t=e.mm.subListActual.find((function(t){return t.key===e.mm.subListSelection.key}));void 0!==t?(e.selectionFound=!0,e.dialog1.remove=!0):(e.selectionFound=!1,e.dialog1.remove=!1)}))}},components:{AlertsSubMenu:oe["a"]}};i("02f0");ae.render=se;t["default"]=ae}}]);
//# sourceMappingURL=chunk-51ff8c02.459f794d.js.map