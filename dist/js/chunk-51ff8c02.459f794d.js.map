{"version":3,"sources":["webpack:///./src/views/alerts/Manage.vue?2f90","webpack:///./src/views/alerts/Manage.vue","webpack:///./src/views/alerts/Manage.vue?627e"],"names":["id","class","style","bg-color","color","round","statusTxt","isSubscribed","unsubscribeUser","disabled","pbIsDisabled","pbLabel","subscribeUser","mm","subListActual","item","key","title","removeActualEvent","reviewActualEvent","length","name","getSelection","size","subListAvail","event","value","selectionFound","subListSelection","subscribeToEvent","dialog1","show","dark","subscribeToDefaultWaypoints","user","alertTestRequest","requestNotificationTest","alertTestedTS","width","persistent","persistent-no-animation","persistentNoAnimation","title-class","actions","remove","src","imagePath","image","height","alt","description","dialog2","actListSelection","beforeMount","this","$store","state","c","loggeduserCredentials","isAnonymous","dispatch","navigator","window","console","log","serviceWorker","register","then","swReg","swRegistration","initialiseUI","catch","error","warn","mounted","commit","unmounted","data","applicationServerPublicKey","publicPath","db","initializeMM","fsAuth","authEnc","deviceRef","fullscreen","methods","ManageModel","showAlert","msg","alert","updateBtn","Notification","permission","urlB64ToUint8Array","base64String","padding","repeat","base64","replace","rawData","atob","outputArray","Uint8Array","i","charCodeAt","applicationServerKey","pushManager","subscribe","userVisibleOnly","subscription","auth","btoa","String","fromCharCode","apply","getKey","p246dh","alertDest","alertMethod","alertNote","userCreatedTS","Math","Date","now","events","endpoint","is_enabled","p256dh","merge","err","getSubscription","getSubList","unsubscribe","ready","serviceWorkerRegistration","errorCode","code","message","userObj","uuid","substr","userID","doc","undefined","Array","isArray","forEach","loadSubListActual","tird","srcIdx","srcArray","find","o","push","sel","components","AlertsSubMenu","render"],"mappings":"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","file":"js/chunk-51ff8c02.459f794d.js","sourcesContent":["export * from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../../node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../../../node_modules/vue-loader-v16/dist/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-2!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader-v16/dist/index.js??ref--0-1!./Manage.vue?vue&type=style&index=0&id=f1295620&lang=css\"","<template>\r\n  <main id=\"Manage\" class=\"text-center\">\r\n    <section>\r\n      <h1>MANAGE NOTIFICATIONS</h1>\r\n      <p>On this browser push notifications are <w-tag class=\"mr4\" bg-color=\"yellow\" color=\"primary\" round>\r\n  {{statusTxt}}</w-tag></p>\r\n      <p class=\"btnWrapper\"><button v-if=\"isSubscribed\" @click=\"unsubscribeUser()\" class=\"pushtoglbtn\" v-bind:disabled='pbIsDisabled'>{{pbLabel}}</button>\r\n      <button  v-else @click=\"subscribeUser()\"  class=\"pushtoglbtn\" v-bind:disabled='pbIsDisabled'>{{pbLabel}}</button>&nbsp; \r\n      </p>\r\n  \r\n    <div class=\"boxa\">\r\n      <h3>Subscribed Events</h3>\r\n      <ol id=\"actualOL\">\r\n        <li v-for=\"item in mm.subListActual\" :key=\"item.key\">\r\n          <span class=\"listItem\">{{item.title}}</span><span class=\"listBtns\"><button v-bind=\"{id: 'remBtn'+item.key}\" @click=\"removeActualEvent(item.key)\">Delete</button>&nbsp;\r\n          <button v-bind=\"{id: 'revBtn'+item.key}\" @click=\"reviewActualEvent(item.key)\">Review</button>\r\n          </span>\r\n        </li>\r\n      </ol>\r\n      <br>\r\n      <w-tag v-if=\"!mm.subListActual.length\" id=\"actualNone\" class=\"mr4\" bg-color=\"primary\" color=\"yellow\" round >None</w-tag>\r\n      \r\n    </div>\r\n    <div class=\"boxb\">\r\n      <h3>Available Events</h3>  \r\n      <select name=\"sub-list-avail\" @change=\"getSelection\" id=\"sub-list-avail\" class=\"form-select\" size=\"5\" >\r\n        <option v-for='event in mm.subListAvail' v-bind:key='event.key' :value='event.key'>{{event.title}}</option>\r\n      </select> <br>   \r\n      <br> \r\n      <!-- Button to Subscribe instantly -->\r\n      <w-button class=\"btnGrpA\" v-if=\"selectionFound\" @click=\"removeActualEvent(mm.subListSelection.key)\">Remove Event</w-button>\r\n      <w-button v-else @click=\"subscribeToEvent()\">Subscribe to Event</w-button>&nbsp;\r\n      <!-- Button to trigger modal -->\r\n      <w-button\r\n        class=\"px4 btnGrpA\"\r\n        @click=\"getSelection; dialog1.show = true\"\r\n        bg-color=\"primary\"\r\n        dark>\r\n        View Details\r\n      </w-button> \r\n      &nbsp;\r\n      <!-- Button to Subscribe to default waypoints -->\r\n      <w-button class=\"btnGrpA\" @click=\"subscribeToDefaultWaypoints\">Add Default Waypoints</w-button>\r\n      <br/>\r\n      <!-- Button to request test notifcation -->\r\n      <div v-if=\"user && user.alertTestRequest\" style=\"color: red\">Test Pending</div>\r\n      <w-button class=\"ma1\" bg-color=\"info\" @click=\"requestNotificationTest\">Notification Test</w-button>\r\n      <div v-if=\"user && user.alertTestedTS!=null\">Last Test Notification Sent {{user.alertTestedTS}}</div>\r\n    </div>\r\n\r\n    <div class=\"boxb boxc\">Consider where along the river you like to watch riverboats. Choose one marker a few miles above your spot for downriver notices. Pick another below your spot for upriver notices. \"Passenger\" events will trigger less often than the \"Any\" vessel events which occur many times daily.\r\n  \r\n    </div>\r\n    <div class=\"boxb boxc\">Please note that \"Any\" means any vessel OTHER than passenger and does not include passenger vessels also. You will get passenger vessel notices only when subscribed to passenger events. \r\n    </div>\r\n  </section>\r\n</main>\r\n<!-- Modal for available list selection -->\r\n<w-dialog  id=\"availModal\" \r\n  v-model=\"dialog1.show\"\r\n  :width=\"1000\"\r\n  :persistent=\"dialog1.persistent\"\r\n  :persistent-no-animation=\"dialog1.persistentNoAnimation\"\r\n  title-class=\"primary-light1--bg white\"\r\n  >    \r\n  <template #title>\r\n    {{ mm.subListSelection.title }} \r\n  </template>\r\n<div class=\"modal-body\">\r\n  <img id=\"vm-image\" class=\"river-map\" :src=\"imagePath +'/'+ mm.subListSelection.image\" height=\"600\" alt=\"Map image of river showing boat icon at edge of target area\"/><br>\r\n  <div class=\"description\" id=\"vm-description\">{{ mm.subListSelection.description }}</div>\r\n</div>\r\n  <template #actions>\r\n    <div class=\"spacer\" />\r\n    <w-button @click=\"dialog1.show = false\">Close </w-button>&nbsp;\r\n    <w-button v-if=\"dialog1.remove\" @click=\"removeActualEvent(mm.subListSelection.key); dialog1.show = false; \">Remove This Event</w-button>\r\n    <w-button v-else @click=\"subscribeToEvent(); dialog1.show = false; \">Subscribe to This Event</w-button>  \r\n  </template>      \r\n</w-dialog>\r\n\r\n<!-- Modal for active list selection -->\r\n<w-dialog  id=\"actualModal\" \r\n  v-model=\"dialog2.show\"\r\n  :width=\"1000\"\r\n  :persistent=\"dialog2.persistent\"\r\n  :persistent-no-animation=\"dialog2.persistentNoAnimation\"\r\n  title-class=\"primary-light1--bg white\"\r\n  >    \r\n  <template #title>\r\n    {{ mm.actListSelection.title }} \r\n  </template>\r\n<div class=\"modal-body\">\r\n  <img id=\"vm-image\" class=\"river-map\" :src=\"imagePath + '/'+mm.actListSelection.image\" height=\"600\" alt=\"Map image of river showing boat icon at edge of target area\"/><br>\r\n  <div class=\"description\" id=\"vm-description\">{{ mm.actListSelection.description }}</div>\r\n</div>\r\n  <template #actions>\r\n    <div class=\"spacer\" />\r\n    <w-button @click=\"dialog2.show = false\">Close </w-button>&nbsp;\r\n    <w-button v-if=\"dialog1.remove\" @click=\"removeActualEvent(); dialog2.show = false; \">Remove This Event</w-button>\r\n    <w-button v-else @click=\"subscribeToEvent(); dialog2.show = false; \">Subscribe to This Event</w-button>  \r\n  </template>      \r\n</w-dialog>\r\n\r\n</template>\r\n\r\n<script>\r\nimport ManageModel from '@/assets/classes/ManageModel.js'\r\n//import 'material-design-icons/iconfont/material-icons.css'\r\nimport AlertsSubMenu from '@/components/AlertsSubMenu.vue'\r\nimport { firestore } from '@/store/firebaseApp.js'\r\nimport { doc, getDoc, setDoc, updateDoc, arrayRemove, onSnapshot } from 'firebase/firestore'\r\nimport { getAuth, signInAnonymously } from \"firebase/auth\";\r\nexport default {\r\n  beforeMount() {\r\n    //Logout user to avoid conflict with annonymous login\r\n    if(this.$store.state.c.loggeduserCredentials && !this.$store.state.c.loggeduserCredentials.isAnonymous) {\r\n      this.$store.dispatch('logOut')\r\n    }\r\n    if ('serviceWorker' in navigator && 'PushManager' in window) {\r\n      console.log('Service Worker and Push is supported');\r\n      //mysw.js has the push method and payload, mysw.js also has the eventhandler for when the notification is clicked\r\n      navigator.serviceWorker.register('../mysw.js') \r\n      .then( (swReg) => {\r\n        console.log('Service Worker is registered', swReg);\r\n        this.swRegistration = swReg;\r\n        console.log(\"swRegistration value: \", this.swRegistration);\r\n        this.initialiseUI();\r\n\r\n      })\r\n      .catch( (error) => {\r\n        console.error('Service Worker Error', error);\r\n      });\r\n    } else {\r\n      console.warn('Push messaging is not supported');\r\n      this.pbLabel = 'Push Not Supported';\r\n    }\r\n  },\r\n  mounted() {\r\n    this.$store.commit('setSlate', 'ALERTS')\r\n    this.$store.commit('setAlertsLinkActive', true)\r\n    this.$store.commit('setPageSelected', 'Manage')\r\n  },\r\n  unmounted() {\r\n    this.$store.commit('setAlertsLinkActive', false)\r\n    this.$store.commit('setPageSelected', null)\r\n    //Disengage anonymous login upon leaving\r\n    this.$store.dispatch('logOut')\r\n  },\r\n  data: function() {\r\n    return {\r\n      applicationServerPublicKey: process.env.VUE_APP_MDM_VKEY,\r\n      publicPath: process.env.BASE_URL,\r\n      imagePath:  process.env.VUE_APP_IMG_URL,\r\n      swRegistration: \"\",\r\n      db: firestore,\r\n      mm: this.initializeMM(),\r\n      fsAuth: getAuth(),\r\n      isSubscribed: false,\r\n      authEnc: null,\r\n      user: null,\r\n      pbIsDisabled: false,\r\n      pbLabel: 'Enable Push',\r\n      statusTxt: 'Disabled',\r\n      deviceRef: \"\",\r\n      dialog1: {\r\n        show: false,\r\n        fullscreen: false,\r\n        persistent: false,\r\n        persistentNoAnimation: false,\r\n        width: 300,\r\n        remove: false\r\n      },\r\n      dialog2: {\r\n        show: false,\r\n        fullscreen: false,\r\n        persistent: false,\r\n        persistentNoAnimation: false,\r\n        width: 300,\r\n      },\r\n      selectionFound: false\r\n    }\r\n  },\r\n  methods: {\r\n    initializeMM() {\r\n      return new ManageModel()\r\n    },\r\n    showAlert(msg) {\r\n      alert(msg)\r\n    },\r\n    updateBtn() {\r\n      if (Notification.permission === 'denied') {\r\n        this.pbLabel = 'Push Messaging Blocked';\r\n        this.pbIsDisabled = true;\r\n        this.statusTxt = 'Blocked';\r\n        //updateSubscriptionOnServer(null);\r\n        return;\r\n      }\r\n      if (this.isSubscribed) {\r\n        this.pbLabel = 'Disable Push';\r\n        this.statusTxt = 'Enabled';\r\n        this.pbIsDisabled = false;\r\n        //this.unsubscribeUser();\r\n      } else {\r\n        this.pbLabel = 'Enable Push';\r\n        this.pbIsDisabled = false;\r\n        this.statusTxt = 'Disabled';\r\n        //this.subscribeUser();\r\n      }\r\n     \r\n    },\r\n    urlB64ToUint8Array(base64String) {\r\n      const padding = '='.repeat((4 - base64String.length % 4) % 4);\r\n      const base64 = (base64String + padding)\r\n        .replace(/\\-/g, '+')\r\n        .replace(/_/g, '/');\r\n\r\n      const rawData = window.atob(base64);\r\n      const outputArray = new Uint8Array(rawData.length);\r\n\r\n      for (let i = 0; i < rawData.length; ++i) {\r\n        outputArray[i] = rawData.charCodeAt(i);\r\n      }\r\n      return outputArray;\r\n    },\r\n    subscribeUser() {\r\n      const applicationServerKey = this.urlB64ToUint8Array(this.applicationServerPublicKey);\r\n      this.swRegistration.pushManager.subscribe({\r\n        userVisibleOnly: true,\r\n        applicationServerKey: applicationServerKey\r\n      })\r\n      .then( (subscription) => {\r\n        console.log('User is subscribed.');\r\n        this.isSubscribed = true;\r\n        this.updateBtn();  \r\n        //Delay to ensure userID is set. Couldn't figure how to get promise to work here.\r\n        let auth = btoa(String.fromCharCode.apply(null, new Uint8Array(subscription.getKey('auth'))));\r\n        let p246dh = btoa(String.fromCharCode.apply(null, new Uint8Array(subscription.getKey('p256dh'))));\r\n        this.user = {\r\n          alertDest: \"\",\r\n          alertMethod: \"notification\",\r\n          alertNote: \"v0 subscribeUser()\",\r\n          alertTestRequest: false,\r\n          alertTestedTS: null,\r\n          userCreatedTS: Math.round(Date.now()/1000),\r\n          events: [],\r\n          subscription: {\r\n            auth:  auth,\r\n            endpoint: subscription.endpoint,\r\n            is_enabled: this.isSubscribed,\r\n            p256dh: p246dh \r\n          }\r\n        }\r\n        setDoc(this.deviceRef, this.user, {merge:true})\r\n      })\r\n      .catch( (err) => {\r\n        console.log('Failed to subscribe the user: ', err);\r\n        this.updateBtn();\r\n      });//\r\n    },\r\n    initialiseUI() {\r\n      // Set the initial subscription value\r\n      this.swRegistration.pushManager.getSubscription()\r\n        .then( (subscription) => {\r\n          this.isSubscribed = !(subscription === null);\r\n          if (this.isSubscribed) {\r\n            console.log('User IS subscribed.');\r\n            //Get list of subscribed events\r\n            this.getSubList();\r\n          } else {\r\n            console.log('User is NOT subscribed.');\r\n          }\r\n          this.updateBtn();\r\n        });\r\n    },\r\n    unsubscribeUser() {\r\n      this.swRegistration.pushManager.getSubscription()\r\n      .then( (subscription) => {\r\n        if (subscription) {\r\n          return subscription.unsubscribe();\r\n        }\r\n      }).catch( (error)  => {\r\n        console.log('Error unsubscribing', error);\r\n      }).then( () => {\r\n\r\n        setDoc(this.deviceRef, {subscription: {is_enabled: false}}, {merge:true});\r\n        console.log('User is unsubscribed.');\r\n        this.isSubscribed = false;\r\n        this.mm.subListActual = [];\r\n        this.updateBtn();\r\n      });\r\n    },\r\n    getSubList() {\r\n      navigator.serviceWorker.ready\r\n      .then(serviceWorkerRegistration => serviceWorkerRegistration.pushManager.getSubscription())\r\n      .then(subscription => {\r\n          if (!subscription) {\r\n              alert('Please enable push notifications');\r\n              return;\r\n          }\r\n          //Login annonymously to firebase auth and get unique uid  \r\n          signInAnonymously(this.fsAuth).catch( (error) => {\r\n             // Handle Errors here.\r\n             let errorCode = error.code;\r\n             let errorMessage = error.message;\r\n             if (errorCode === 'auth/operation-not-allowed') {\r\n               alert('You must enable Anonymous auth in the Firebase Console.');\r\n             } else {\r\n               console.error(error);\r\n             }\r\n          })\r\n          .then( (userObj) => {\r\n            //Use returned user object's uid to get or create new db document\r\n            //NEW WAY: DON'T LOG ANNONYMOUS ID, USE SUBCR ID INSTEAD\r\n            //console.log(\"Returned userObj: \",userObj);\r\n            //Use browser's subsription endpoint as login uuid \r\n            let uuid = subscription.endpoint.substr(-20,20)\r\n            this.mm.userID = uuid              \r\n            if(this.mm.userID==null) { \r\n              alert(\"Error generating a UUID.  Try again later.\");\r\n            } else {\r\n              console.log('this.mm.userID=',this.mm.userID);\r\n            }    \r\n            this.deviceRef = doc(this.db, 'user_devices', this.mm.userID);\r\n            /*   BLOCK START                 */\r\n            onSnapshot(this.deviceRef, \r\n              (doc) => {\r\n                //Done each time db updates\r\n                this.user = doc.data();\r\n                console.log(\"doc.data()\", this.user);\r\n                this.mm.subListActual = [];\r\n                if(this.user !== undefined) {\r\n                  if(Array.isArray(this.user.events) && this.user.events.length) {\r\n                    this.user.events.forEach(this.loadSubListActual);\r\n                  }  \r\n                } else {\r\n                  let userObj = {\r\n                  alertDest: \"\",\r\n                  alertMethod: \"notification\",\r\n                  alertNote: \"v2 onSnapshot()\",\r\n                  alertTestRequest: false,\r\n                  alertTestedTS: null,\r\n                  userID: this.mm.userID,\r\n                  userCreatedTS: Math.round(Date.now()/1000),\r\n                  events: [],\r\n                  subscription: {\r\n                    auth:  \"\",\r\n                    endpoint: subscription.endpoint,\r\n                    is_enabled: false,\r\n                    p256dh: \"\" \r\n                  }\r\n                };\r\n                setDoc(this.deviceRef, userObj)\r\n                } \r\n              }, \r\n              () => {\r\n                //Create if not found\r\n                let userObj = {\r\n                  alertDest: \"\",\r\n                  alertMethod: \"notification\",\r\n                  alertNote: \"v2 onSnapshot()\",\r\n                  alertTestRequest: false,\r\n                  alertTestedTS: null,\r\n                  userID: this.mm.userID,\r\n                  userCreatedTS: Math.round(Date.now()/1000),\r\n                  events: [],\r\n                  subscription: {\r\n                    auth:  \"\",\r\n                    endpoint: subscription.endpoint,\r\n                    is_enabled: false,\r\n                    p256dh: \"\" \r\n                  }\r\n                };\r\n                setDoc(this.deviceRef, userObj)\r\n            })\r\n          })              \r\n      }); \r\n      \r\n    }, \r\n    loadSubListActual(tird, srcIdx, srcArray) {\r\n      //This function used by getSubList()\r\n      //console.log('scrVal: ', tird, '\\n srcIdx: ', srcIdx, '\\n scrArray: ', srcArray, '\\n');\r\n      let item = this.mm.subListAvail.find(o => o.key === tird);\r\n      this.mm.subListActual.push(item);\r\n    },\r\n    reviewActualEvent(key) {\r\n      let sel = this.mm.subListAvail.find(o => o.key === key);\r\n      sel['isSubscribed'] = true;\r\n      this.mm.actListSelection = sel;\r\n      console.log(\"actSel description: \", this.mm.actListSelection.description);\r\n      this.dialog2.show = true;\r\n      this.dialog1.remove = true;\r\n    },\r\n    removeActualEvent(key=\"\", isModal=false) {\r\n      //Get key alternately if in param\r\n      if(key==\"\") {\r\n        key = this.mm.actListSelection.key;\r\n      }\r\n      //Update db\r\n      console.log(\"removeActualEvent() subListSelection.key =\", this.mm.actListSelection.key);\r\n      console.log(\"removeActualEvent(\"+key+\")\")\r\n      updateDoc(this.deviceRef, {events: arrayRemove(key)})\r\n        .then( console.log(\"removeActualEvent(\"+key+\")\") )\r\n      this.selectionFound = false;\r\n      this.dialog1.remove = false;  \r\n    },\r\n    subscribeToEvent() {\r\n      if(this.user===undefined)  {\r\n        alert(\"You must enable (or re-enable) Push service before you can add events.\");\r\n        return;\r\n      }\r\n      console.log(\"subListSelection =\", this.mm.subListSelection.key);\r\n      this.user.events.push(this.mm.subListSelection.key);\r\n      setDoc(this.deviceRef, {events: this.user.events} , {merge:true})\r\n      console.log('subscribeToEvent()');\r\n      this.getSelection();\r\n    },\r\n    requestNotificationTest() {\r\n      console.log(\"requestNotificationTest()\")\r\n      setDoc(this.deviceRef, {alertTestRequest: true }, {merge:true})\r\n      alert(\"Please allow up to 3 minutes for test message to be sent to you.\")\r\n    },\r\n    subscribeToDefaultWaypoints() {\r\n      if(this.user===null)  {\r\n        alert(\"You must enable Push service before you can add events.\");\r\n        return;\r\n      }\r\n      this.user.events.push('alphadp', 'deltaup');\r\n      setDoc(this.deviceRef, {events: this.user.events} , {merge:true});\r\n      //this.getSelection();\r\n    },\r\n    getSelection() {\r\n      this.mm.getSelection().then( () => {\r\n        let sel = this.mm.subListActual.find(o => o.key === this.mm.subListSelection.key);\r\n        if(sel !== undefined) {\r\n          this.selectionFound = true;\r\n          this.dialog1.remove = true;\r\n        } else {\r\n          this.selectionFound = false;\r\n          this.dialog1.remove = false;\r\n        }\r\n      });\r\n    }  \r\n  },\r\n  components: {\r\n    AlertsSubMenu\r\n  }\r\n}\r\n</script>\r\n\r\n<style>\r\n\r\n#Manage section {\r\n  padding-top: var(--menu-pad-wide-a);\r\n}\r\n\r\nimg.river-map {\r\n  overflow: scroll;\r\n}\r\n\r\nli {\r\n  margin: 2px 2px 2px 5%;\r\n  text-align: left;  \r\n}\r\n\r\n.listItem {\r\n  float: left;\r\n}\r\n\r\n.listBtns {\r\n  display: block;\r\n  text-align: right; \r\n}\r\n\r\n.btnGrpA {\r\n  padding: .5rem;\r\n  margin: .5rem;\r\n}\r\n\r\n.boxa {\r\n  margin: auto;\r\n  width: 40em; \r\n  text-align: center; \r\n  background-color: #dccce0; \r\n  padding: 1em;\r\n  border-bottom: 2em;\r\n  border-spacing: 1em;\r\n}\r\n\r\n.boxb {\r\n  margin: auto; \r\n  width: 40em; \r\n  text-align: center; \r\n  background-color: #cce0e0; \r\n  padding: 1em;\r\n}\r\n\r\n.boxb.boxc {\r\n  text-align: justify;\r\n}\r\n\r\n\r\n@media (max-width: 750px) {\r\n  #Manage section {\r\n    padding-top: var(--menu-pad-mobile);\r\n  }\r\n  .boxa, .boxb {\r\n    width: 26rem;\r\n  }\r\n}\r\n</style>\r\n\r\n","import { render } from \"./Manage.vue?vue&type=template&id=f1295620\"\nimport script from \"./Manage.vue?vue&type=script&lang=js\"\nexport * from \"./Manage.vue?vue&type=script&lang=js\"\n\nimport \"./Manage.vue?vue&type=style&index=0&id=f1295620&lang=css\"\nscript.render = render\n\nexport default script"],"sourceRoot":""}